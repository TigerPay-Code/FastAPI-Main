# Pydantic 模型中各种字段类型的详细示例

以下是包含各种常见字段类型的详细示例，包括时间戳、字符串、数值、布尔值、枚举、列表、嵌套模型等：

```python
#!/usr/bin/env python
# -*- coding: utf-8 -*-
# @Author    : 贺鉴龙
# @File      : base.py
# @Time      : 2025/9/16 11:18
# @IDE       : PyCharm
# @Function  :
import os
import time
from typing import Optional, List, Dict, Any, Union
from enum import Enum
from datetime import datetime, date
from pydantic import BaseModel, Field, validator, HttpUrl, EmailStr
from Logger.logger_config import setup_logger

log_name = os.path.basename(os.path.dirname(os.path.abspath(__file__)))
logger = setup_logger(log_name)

# 枚举类型示例
class PaymentStatus(Enum):
    PENDING = "pending"
    SUCCESS = "success"
    FAILED = "failed"
    REFUNDED = "refunded"

class Currency(Enum):
    CNY = "CNY"
    USD = "USD"
    EUR = "EUR"
    GBP = "GBP"

# 嵌套模型示例
class CustomerInfo(BaseModel):
    name: str = Field(title="客户姓名", min_length=1, max_length=50)
    email: EmailStr = Field(title="邮箱地址")
    phone: str = Field(title="手机号", regex=r"^1[3-9]\d{9}$")
    address: Optional[str] = Field(title="地址", default=None)

class ProductItem(BaseModel):
    id: str = Field(title="商品ID")
    name: str = Field(title="商品名称")
    price: int = Field(title="商品价格(分)", ge=0)
    quantity: int = Field(title="数量", ge=1)

# 接收Pay-RX支付通知数据模型
class Pay_RX_Notify_In_Data(BaseModel):
    # 基本类型字段
    state: int = Field(title="代收状态", description="0-订单生成,1-支付中,2-支付成功,3-支付失败", default=0, ge=0, le=3)
    sysOrderNo: str = Field(title="平台订单号", description="系统订单号", min_length=4, max_length=36)
    mchOrderNo: str = Field(title="下游订单号", description="商户订单号", min_length=4, max_length=36)
    amount: int = Field(title="金额", description="单位分", ge=1000, le=1000000)
    
    # 时间戳字段
    timestamp: int = Field(
        title="时间戳", 
        description="Unix时间戳，精确到秒", 
        default_factory=lambda: int(time.time())
    )
    
    # 日期时间字段
    created_at: datetime = Field(
        title="创建时间",
        default_factory=datetime.now
    )
    
    # 日期字段
    expiry_date: date = Field(
        title="过期日期",
        default_factory=lambda: date.today()
    )
    
    # 可选字段
    extraField: Optional[str] = Field(title="扩展字段", description="可选字段", min_length=0, max_length=32, default=None)
    
    # 布尔字段
    is_test: bool = Field(title="测试模式", default=False)
    
    # 枚举字段
    status: PaymentStatus = Field(title="支付状态", default=PaymentStatus.PENDING)
    currency: Currency = Field(title="货币类型", default=Currency.CNY)
    
    # URL字段
    callback_url: Optional[HttpUrl] = Field(title="回调URL", default=None)
    
    # 列表字段
    product_list: List[ProductItem] = Field(title="商品列表", default_factory=list)
    
    # 字典字段
    metadata: Dict[str, Any] = Field(title="元数据", default_factory=dict)
    
    # 联合类型字段
    reference_id: Union[str, int] = Field(title="参考ID", default="")
    
    # 嵌套模型字段
    customer: Optional[CustomerInfo] = Field(title="客户信息", default=None)
    
    # 签名字段
    sign: str = Field(title="签名", description="签名值大写的MD5值", min_length=32, max_length=32)
    
    # 自定义验证器示例
    @validator('amount')
    def validate_amount(cls, v):
        if v % 100 != 0:
            raise ValueError('金额必须是100的倍数')
        return v
    
    @validator('timestamp')
    def validate_timestamp(cls, v):
        current_time = int(time.time())
        # 时间戳不能是未来的时间（允许最多5分钟的时钟偏差）
        if v > current_time + 300:
            raise ValueError('时间戳不能是未来的时间')
        return v


class Pay_RX_Notify_Out_Data(BaseModel):
    state: int = Field(title="支付状态", description="0-订单生成,1-付款中,2-付款成功,3-付款失败", default=0)
    sysOrderNo: str = Field(title="平台订单号", description="系统订单号", min_length=4, max_length=36)
    mchOrderNo: str = Field(title="下游订单号", description="商户订单号", min_length=4, max_length=36)
    amount: int = Field(title="金额", description="单位分", ge=1, le=1000000)
    timestamp: int = Field(
        title="时间戳", 
        description="Unix时间戳，精确到秒", 
        default_factory=lambda: int(time.time())
    )
    sign: str = Field(title="签名", description="签名值大写的MD5值", min_length=32, max_length=32)


class Pay_RX_Notify_Refund_Data(BaseModel):
    state: int = Field(title="退款状态", description="0-订单生成,1-退款中,2-退款成功,3-退款失败", default=0)
    sysOrderNo: str = Field(title="平台订单号", description="系统订单号", min_length=4, max_length=36)
    mchOrderNo: str = Field(title="下游订单号", description="商户订单号", min_length=4, max_length=36)
    amount: int = Field(title="金额", description="单位分", ge=1, le=1000000)
    timestamp: int = Field(
        title="时间戳", 
        description="Unix时间戳，精确到秒", 
        default_factory=lambda: int(time.time())
    )
    sign: str = Field(title="签名", description="签名值大写的MD5值", min_length=32, max_length=32)


# 使用示例
if __name__ == "__main__":
    # 创建客户信息
    customer = CustomerInfo(
        name="张三",
        email="zhangsan@example.com",
        phone="13800138000",
        address="北京市朝阳区"
    )
    
    # 创建商品列表
    products = [
        ProductItem(id="001", name="商品A", price=1000, quantity=2),
        ProductItem(id="002", name="商品B", price=2000, quantity=1)
    ]
    
    # 创建支付通知数据
    payment_data = Pay_RX_Notify_In_Data(
        state=1,
        sysOrderNo="ORDER20250916123456",
        mchOrderNo="MCH20250916123456",
        amount=4000,  # 40元
        extraField="测试数据",
        is_test=True,
        status=PaymentStatus.PENDING,
        currency=Currency.CNY,
        callback_url="https://example.com/callback",
        product_list=products,
        metadata={"source": "web", "version": "1.0"},
        reference_id=12345,
        customer=customer,
        sign="SIGNATURE1234567890ABCDEF1234567890AB"
    )
    
    print("支付通知数据:")
    print(payment_data.json(indent=2, ensure_ascii=False))
    
    # 验证数据
    try:
        # 测试验证器 - 金额不是100的倍数
        invalid_payment = Pay_RX_Notify_In_Data(
            state=1,
            sysOrderNo="ORDER20250916123456",
            mchOrderNo="MCH20250916123456",
            amount=1234,  # 不是100的倍数
            sign="SIGNATURE1234567890ABCDEF1234567890AB"
        )
    except ValueError as e:
        print(f"\n验证错误: {e}")
    
    # 输出模型结构
    print("\n模型结构:")
    print(Pay_RX_Notify_In_Data.schema_json(indent=2))
```

## 字段类型详解

1. **基本类型**:
   - `int`: 整数类型，可添加范围约束 (`ge`, `le`)
   - `str`: 字符串类型，可添加长度约束 (`min_length`, `max_length`)
   - `bool`: 布尔类型

2. **时间相关类型**:
   - `timestamp`: Unix时间戳（整数）
   - `created_at`: `datetime` 类型，表示日期和时间
   - `expiry_date`: `date` 类型，只表示日期

3. **可选字段**:
   - 使用 `Optional[...]` 表示字段可为空
   - 通常与 `default=None` 配合使用

4. **枚举类型**:
   - 使用 `Enum` 类定义枚举
   - 确保字段值只能是预定义的选项

5. **特殊格式字段**:
   - `EmailStr`: 验证电子邮件格式
   - `HttpUrl`: 验证URL格式
   - 使用 `regex` 参数验证手机号等格式

6. **集合类型**:
   - `List[...]`: 列表类型，可包含特定类型的元素
   - `Dict[str, Any]`: 字典类型，键为字符串，值为任意类型

7. **联合类型**:
   - `Union[str, int]`: 字段可以是字符串或整数类型

8. **嵌套模型**:
   - 可以在一个模型中包含另一个模型作为字段

9. **默认值**:
   - `default=value`: 静态默认值
   - `default_factory=callable`: 动态默认值，每次创建实例时调用

10. **自定义验证器**:
    - 使用 `@validator` 装饰器创建自定义验证逻辑
    - 可以验证字段值是否符合特定业务规则